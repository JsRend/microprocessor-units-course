# Регистр АЦП - Analog-to-digital converter (ADC)

В этом разделе дается подробное описание регистров ADC.

- [Регистр АЦП - Analog-to-digital converter (ADC)](#регистр-ацп---analog-to-digital-converter-adc)
  - [Регистр прерывания и состояния АЦП](#регистр-прерывания-и-состояния-ацп)
  - [Регистр разрешения прерываний АЦП](#регистр-разрешения-прерываний-ацп)
  - [Регистр управления АЦП](#регистр-управления-ацп)

---

## Регистр прерывания и состояния АЦП

ADC interrupt and status register (ADCx->ISR)

![RCC](../../img/ADC_ISR.png)

Смещение адреса: `0x00`

Значение после сброса: `0x0000 0000`

Биты 31-8: Зарезервированы.

Бит 7 `AWD`: Флаг аналогового сторожевого таймера. Бит устанавливается аппаратным способом, когда преобразованное напряжение пересекает значения, загруженные в
регистры `ADCx->LTR` и `ADCx->HTR`. Бит очищается программно, записывая в него 1.

- `0`: Событие аналогового сторожевого таймера не произошло (или флаг события уже был проверен и сброшен программно)
- `1`: Произошло событие аналогового сторожевого таймера

Биты 6-5: Зарезервированы.

Бит 4 `OVR`: Флаг переполнения регистра АЦП. Бит устанавливается аппаратно при переполнении, когда новое преобразование завершено, в то время как флаг EOC уже был установлен. Бит очищается программно, записывая в него 1.

- `0`: Переполнения не произошло (или флаг события уже был проверен и сброшен программно)
- `1`: Произошло переполнение

Бит 3 `EOSEQ`: Флаг завершения преобразования последовательности каналов АЦП. Бит устанавливается аппаратно в конце преобразования выбранной битами `CHSEL` последовательности каналов. Бит очищается программно, записывая в него 1.

- `0`: Последовательность преобразования не завершена (или флаг события уже был проверен и сброшен программно)
- `1`: Последовательность преобразования завершена

Бит 2 `EOC`: Флаг окончания преобразования АЦП. Бит устанавливается аппаратно в конце каждого преобразования канала, когда в регистре `ADCx->DR` доступен новый результат данных. Бит очищается программно, записывая в него 1.

- `0`: Преобразование канала не завершено (или флаг события уже был проверен и сброшен программно)
- `1`: Преобразование канала завершено

Бит 1 `EOSMP`: Флаг окончания выборки АЦП. Бит устанавливается аппаратно во время преобразования, в конце фазы выборки. Флаг очищается программно, записывая в него 1.

- `0`: Выборка не завершена (или флаг события уже был проверен и сброшен программно)
- `1`: Выборка завершена

Бит 0 `ADRDY`: Флаг готовности АЦП. Бит устанавливается аппаратно после включения АЦП (бит ADEN=1) и когда АЦП достигает состояния, в котором он готов принимать новые запросы на преобразование. Бит очищается программно, записывая в него 1.

- `0`: АЦП еще не готов начать преобразование (или флаг события уже был проверен и сброшен программно)
- `1`: АЦП готов к началу преобразования

---

## Регистр разрешения прерываний АЦП

ADC interrupt enable register (`ADCx->IER`)

![RCC](../../img/ADC_IER.png)

Смещение адреса: `0x04`

Значение после сброса: `0x0000 0000`

Биты 31-8: Зарезервированы.

Бит 7 `AWDIE`: Включение прерывания по аналоговому компаратору. Бит устанавливается и сбрасывается программно.

- `0`: Выключение прерывания по аналоговому компаратору
- `1`: Включение прерывания по аналоговому компаратору

> :bulb: **Примечание:** Программному обеспечению разрешается записывать этот бит только при ADSTART=0 (что гарантирует, что преобразование не выполняется).

Биты 6-5: Зарезервированы.

Бит 4 `OVRIE`: Включение прерывания по переполнению регистра АЦП. Бит устанавливается и сбрасывается программно.

- `0`: Выключение прерывания по переполнению регистра АЦП
- `1`: Включение прерывания по переполнению регистра АЦП

Бит 3 `EOSEQIE`: Включение прерывания по преобразования последовательности каналов АЦП. Бит устанавливается и сбрасывается программно.

- `0`: Выключение прерывания по окончанию преобразования последовательности каналов АЦП
- `1`: Включение прерывания по окончанию преобразования последовательности каналов АЦП

Бит 2 `EOCIE`: Включение прерывания по окончанию преобразования АЦП. Бит устанавливается и сбрасывается программно.

- `0`: Выключение прерывания по событию окончанию преобразования АЦП
- `1`: Включение прерывания по событию окончанию преобразования АЦП

Бит 1 `EOSMPIE`: Включение прерывания по окончания выборки АЦП. Бит устанавливается и сбрасывается программно.

- `0`: Выключение прерывания по окончанию выборки АЦП
- `1`: Включение прерывания по окончанию выборки АЦП

Бит 0 `ADRDYIE`: Включение прерывания по готовности АЦП. Бит устанавливается и сбрасывается программно.

- `0`: Выключение прерывания по готовности АЦП
- `1`: Включение прерывания по готовности АЦП

---

## Регистр управления АЦП

ADC control register (`ADCx->CR`)

![RCC](../../img/ADC_CR.png)

Смещение адреса: `0x08`

Значение после сброса: `0x0000 0000`

Бит 31 `ADCAL`: Калибровка АЦП. Бит устанавливается программно для запуска калибровки АЦП и очищается аппаратно по окончании калибровки.

- `0`: Калибровка АЦП завершена
- `1`: Установка 1 запускает калибровку АЦП. Чтение 1 означает, что идет процесс калибровки

> :bulb: **Примечание:** Разрешается устанавливать ADCAL только в том случае, если АЦП отключен (ADCAL=0, ADSTART=0, ADSTP=0, ADDIS=0 и ADEN=0).

Биты 30-5: Зарезервированы.

Бит 4 `ADSTP`: Остановка преобразования АЦП. Бит устанавливается программно для остановки текущего преобразования. Очищается аппаратно, когда фактически преобразование остановлено и АЦП готов принять новую команду запуска преобразования.

- `0`: преобразование АЦП не останавливается
- `1`: Установка 1 останавливает преобразование АЦП. Чтение 1 означает, что идет процесс остановки

> :bulb: **Примечание:** Установка ADSTP в 1 эффективна только в том случае, если ADSTART=1 и ADDIS =0 (АЦП включен и может преобразовывать, и нет ожидающего запроса на отключение АЦП).

Бит 3: Зарезервирован.

Бит 2 `ADSTART`: Команда запуска преобразования АЦП. Бит устанавливается программно для запуска преобразования АЦП. В зависимости от битов конфигурации `EXTEN[1:0]`,
преобразование либо начинается немедленно (программный триггер), либо после возникновения события аппаратного триггера (аппаратный триггер).

Бит очищается аппаратно:

– В режиме одиночного преобразования (CONT=0, DISCEN=0), когда выбран программный триггер (EXTEN=00): при появление флага окончания последовательности преобразования (EOSEQ).
– В режиме прерывистого преобразования (CONT=0, DISCEN=1), когда выбран программный триггер
(EXTEN=00): при после появления флага окончания преобразования (EOC).
– Во всех остальных случаях: после выполнения команды ADSTP, одновременно с тем, как бит
ADSTP очищается аппаратно.

- `0`: АЦП не запускает преобразование
- `1`: Установка 1 запускает преобразование АЦП. Чтение 1 означает, что идет процесс преобразования

> :bulb: **Примечание:** Разрешено устанавливать ADSTART только при ADEN=1 и ADDIS=0 (АЦП включен и ожидающий запрос на отключение АЦП отсутствует).

Бит 1 `ADDIS`: Выключение АЦП. Бит устанавливается программно для отключения АЦП. Очищается аппаратно, когда фактически АЦП отключен.

- `0`: АЦП не выключается
- `1`: Установка 1 отключает АЦП. Чтение 1 означает, что идет процесс отключения

> :bulb: **Примечание:** Установка ADDIS в 1 работает только в том случае, если ADEN=1 и ADSTART =0 (что гарантирует, что преобразование не выполняется).

Бит 0 `ADDEN`: Включение АЦП. Бит устанавливается программно для включения АЦП. АЦП будет  готов к работе, как только будет установлен флаг `ADRDY`.

- `0`: АЦП выключен
- `1`: Установка 1 включает АЦП. Чтение 1 означает, что АЦП включен

> :bulb: **Примечание:**  Устанавливать ADEN можно только тогда, когда все биты регистров ADCx->CR равны 0 (ADCAL=0, ADSTP=0, ADSTART=0, ADDIS=0 и ADEN=0).
